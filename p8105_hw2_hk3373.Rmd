---
title: "P8105 Homework 2"
author: "Hyun Kim (hk3373)"
date: "`r Sys.Date()`"
output: github_document
---

``` {r setup, echo = FALSE, message = FALSE}
library(tidyverse)
```

# Problem 1

## Import and tidy NYC transit dataset:
```{r import_transit_data}

nyc_transit_df = 
  read_csv("./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv",
           na = "",
           col_types = cols(
             `Route8` = col_character(),
             `Route9` = col_character(),
             `Route10` = col_character(),
             `Route11` = col_character()
           )) |>
  janitor::clean_names() |>
  select(line:entry, vending, ada) |>
  mutate(entry = 
           case_match(
             entry,
             "YES" ~ TRUE,
             "NO" ~ FALSE),
         entry = as.logical(entry))

str(nyc_transit_df)

```

The dataset includes transit line, station name, latitude, longitude, routes 
(from 1 to 11), entrance type, entry, vending and ada compliance. The station's 
latitude and longitude are numeric variables, while entry and ada compliance are
logical variables. The other variables, such as line, station name, entrance 
type, vending and route1 to route11 are character variables. 

For the data cleaning process, NA values were defined when reading the csv file, 
and route8 to route11 were converted to character variables for consistency 
since route1 to route7 were character variables. The dataset has a dimension of 
`r nrow(nyc_transit_df)` rows and `r ncol(nyc_transit_df)` columns. The dataset 
is not tidy since route number should be a variable including the values of all 
routes, which can be resolved using the pivot_longer function.

### How many distinct stations are there? 
```{r compute_distinct_stations}
num_station = nrow(nyc_transit_df |> 
                      distinct(line, station_name))
```
There are `r num_station` distinct stations.

### How many stations are ADA compliant?
```{r compute_ada_compliant} 
num_ada = nrow(nyc_transit_df |> 
                 filter(ada==TRUE) |> 
                 distinct(line, station_name))
```
`r num_ada` stations are ADA compliant. 

### What proportion of station entrances / exits without vending allow entrance?
```{r compute_proportion_entrance}
prop_entrance = round(
  nrow(nyc_transit_df |> 
          filter(vending == "NO") |> 
          filter(entry == TRUE)) / 
     nrow(nyc_transit_df |>
            filter(vending == "NO")) * 100, 2)
```
`r prop_entrance` percent of station entrances/exits without vending allow 
entrance. 

## Reformat transit data:
```{r reformat_transit_data}

nyc_transit_df = nyc_transit_df |>
  pivot_longer(
    route1:route11,
    names_to = "route_number",
    values_to = "route_name"
  ) |>
  relocate(route_number, route_name) |>
  drop_na()

```

### How many distinct stations serve the A train? 
```{r compute_distinct_A} 
num_stations_A = nrow(nyc_transit_df |> 
                          filter(route_name == "A") |> 
                          distinct(line, station_name))
```
`r num_stations_A` distinct stations serve the A train. 

### Of the stations that serve the A train, how many are ADA compliant?
```{r compute_ada_A}
num_ada_A = nrow(nyc_transit_df |> 
                         filter(route_name == "A") |> 
                         filter(ada == TRUE) |> distinct(line, station_name))
```
`r num_ada_A` of the stations that serve the A train are ADA compliant.
